<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>COS_Renesas: cos_semaphore.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">COS_Renesas
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">cos_semaphore.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Dies ist die renesas Version der COS-Semaphoren.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="cos__scheduler_8h_source.html">cos_scheduler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cos__linear__task__list_8h_source.html">cos_linear_task_list.h</a>&quot;</code><br />
</div>
<p><a href="cos__semaphore_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_cos_sema__t.html">CosSema_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a60300e4cadbdf3e9420a4f2b828833da"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cos__semaphore_8h.html#a60300e4cadbdf3e9420a4f2b828833da">COS_SEM_WAIT</a>(s,  pt)</td></tr>
<tr class="separator:a60300e4cadbdf3e9420a4f2b828833da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a08f75de99241fa21e57101d977049c2a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cos__types_8h.html#ab077fa1127453be2bd9d4c3c8a768fa7">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cos__semaphore_8h.html#a08f75de99241fa21e57101d977049c2a">COS_SemCreate</a> (<a class="el" href="struct_cos_sema__t.html">CosSema_t</a> *s, <a class="el" href="cos__types_8h.html#a9702e5ca80edeea90fa9b8fae49f05ce">int8_t</a> n_start)</td></tr>
<tr class="separator:a08f75de99241fa21e57101d977049c2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc1c9e15246c77eb7e5325049600de5b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cos__types_8h.html#ab077fa1127453be2bd9d4c3c8a768fa7">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cos__semaphore_8h.html#acc1c9e15246c77eb7e5325049600de5b">COS_SemDestroy</a> (<a class="el" href="struct_cos_sema__t.html">CosSema_t</a> *s)</td></tr>
<tr class="separator:acc1c9e15246c77eb7e5325049600de5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47f0dd5e1224cd8355208dd3b53d6e86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cos__semaphore_8h.html#a47f0dd5e1224cd8355208dd3b53d6e86">COS_SEM_SIGNAL</a> (<a class="el" href="struct_cos_sema__t.html">CosSema_t</a> *s)</td></tr>
<tr class="separator:a47f0dd5e1224cd8355208dd3b53d6e86"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Dies ist die renesas Version der COS-Semaphoren. </p>
<dl class="section user"><dt>Project : co-operative Scheduler renesas uC</dt><dd></dd></dl>
<dl class="section user"><dt>Module : Counting Semaphore fuer co-operative Scheduler (COS)</dt><dd></dd></dl>
<dl class="section user"><dt>Author : Fgb</dt><dd></dd></dl>
<dl class="section user"><dt>Department: E14</dt><dd></dd></dl>
<dl class="section user"><dt>Company : Fachhochschule Hannover - University of Applied</dt><dd>Sciences and Arts</dd></dl>
<h1><a class="anchor" id="Wie"></a>
funktioniert ein Semaphor in COS?</h1>
<p>Es sind nur zaehlende Semaphoren implementiert. Ein Semaphor in COS besteht aus einem Zaehler und einer Liste von Tasks, die an diesem Semaphor blockierend warten. Das Macro <a class="el" href="cos__semaphore_8h.html#a60300e4cadbdf3e9420a4f2b828833da">COS_SEM_WAIT(s,pt)</a> versucht den Zaehler des Semaphor zu verringern. Ist der Zaehler &gt;0, so wird er dekrementiert und die Task laeuft bei der naechsten Aktivierung mit dem naechsten Befehl nach dem Macro weiter. Ist der Zaehler &lt;=0 , so ist der Semaphor bereits belegt und die Task muss 'blockieren'. Da es ein wirkliches Blockieren einer Task in COS nicht geben darf (DEADLOCK!), wird hier nur der Zustand der Task auf TASK_STATE_BLOCKED gesetzt und die Task in die Warteliste des Semaphor eingetragen. Der Zaehler wird dekrementiert und ist ggf. negativ. Ist der Zaehler &lt;=0 , so zeigt der Betrag des Zaehlers an, wieviele Tasks in der Warteliste stehen. Solange der Zustand der Task TASK_STATE_BLOCKED ist, wird der Scheduler sie nicht aktivieren, dies simuliert das 'Blockieren'. Erst wenn sich der Zustand auf TASK_STATE_READY geaendert hat, wird die Task erneut aktiviert und laeuft mit dem naechsten Befehl nach dem Macro weiter. Die Zustandsaenderung auf TASK_STATE_READY erfolgt durch die Funktion <a class="el" href="cos__semaphore_8h.html#a47f0dd5e1224cd8355208dd3b53d6e86">COS_SEM_SIGNAL(CosSema_t *s)</a>. Hier wird der Zaehler des Semaphor inkrementiert und, falls die Warteliste nicht leer ist, wird die erste Task in der Warteliste in den Zustand TASK_STATE_READY geschaltet.</p>
<dl class="section user"><dt>History :</dt><dd><pre class="fragment">Version | Date        | Author        | Change Description
0.0     | 29.04. 2011 | Fgb           | First Version, Linux
0.1     | 17.09. 2013 | Fgb           | nur noch Atmel, deutsche Doku.
0.2     | 08.10. 2015 | Fgb           | Umbau auf renesas controller
0.3     | 22.10.2015  | Fgb           | Bugfix in COS_SEM_WAIT(), siehe dort</pre> </dd></dl>

<p>Definition in file <a class="el" href="cos__semaphore_8h_source.html">cos_semaphore.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a60300e4cadbdf3e9420a4f2b828833da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COS_SEM_WAIT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">s, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">pt&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">(pt)-&gt;lineCnt=__LINE__;\</div>
<div class="line">                            if((s)-&gt;count &lt;= 0) {  \</div>
<div class="line">                              (pt)-&gt;state = <a class="code" href="cos__linear__task__list_8h.html#a615b8a1e56ec0a612fd589cda743f6b3">TASK_STATE_BLOCKED</a>; \</div>
<div class="line">                              (s)-&gt;root_pt=<a class="code" href="cos__linear__task__list_8c.html#a6aa37ea8394635f8b70a69014b0d0816">_addTaskAtBeginningOfTaskList</a>((s)-&gt;root_pt,(pt)); \</div>
<div class="line">                            } \</div>
<div class="line">                            ((s)-&gt;count)--; \</div>
<div class="line">                            return;\</div>
<div class="line">                            case __LINE__:</div>
<div class="ttc" id="cos__linear__task__list_8h_html_a615b8a1e56ec0a612fd589cda743f6b3"><div class="ttname"><a href="cos__linear__task__list_8h.html#a615b8a1e56ec0a612fd589cda743f6b3">TASK_STATE_BLOCKED</a></div><div class="ttdeci">#define TASK_STATE_BLOCKED</div><div class="ttdef"><b>Definition:</b> <a href="cos__linear__task__list_8h_source.html#l00077">cos_linear_task_list.h:77</a></div></div>
<div class="ttc" id="cos__linear__task__list_8c_html_a6aa37ea8394635f8b70a69014b0d0816"><div class="ttname"><a href="cos__linear__task__list_8c.html#a6aa37ea8394635f8b70a69014b0d0816">_addTaskAtBeginningOfTaskList</a></div><div class="ttdeci">Node_t * _addTaskAtBeginningOfTaskList(Node_t *root_pt, CosTask_t *task_pt)</div><div class="ttdef"><b>Definition:</b> <a href="cos__linear__task__list_8c_source.html#l00127">cos_linear_task_list.c:127</a></div></div>
</div><!-- fragment --><dl class="section user"><dt>Beschreibung</dt><dd>Dieses Macro laesst eine Task an einem Semaphor warten. Die Task blockiert nie, wenn <a class="el" href="cos__semaphore_8h.html#a60300e4cadbdf3e9420a4f2b828833da">COS_SEM_WAIT()</a> zur Blockade fuehren soll, dann muss die Taskfunktion verlassen werden und das naechste mal an der naechsten Befehlszeile weiterlaufen. Der Zustand der Task wird dann auf TASK_STATE_BLOCKED gesetzt, der Scheduler wird diese Task nicht mehr starten. Die Task wird in die Liste der an diesem Sema wartenden Tasks eingetragen.</dd></dl>
<p>Eventuell sollte man die Liste nach Task-Prio sortieren. Aber auch wenn man die Warteliste nach Prioritaet sortiert, ist das Problem von Prioritaetsinversionen nicht geloest.</p>
<dl class="section see"><dt>See also</dt><dd><ul>
<li><a class="el" href="cos__semaphore_8h.html#a08f75de99241fa21e57101d977049c2a">COS_SemCreate()</a>, <a class="el" href="cos__semaphore_8h.html#acc1c9e15246c77eb7e5325049600de5b">COS_SemDestroy()</a></li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>- IN, Zeiger auf Semaphore struct: <a class="el" href="struct_cos_sema__t.html">CosSema_t</a> </td></tr>
    <tr><td class="paramname">pt</td><td>- IN, Zeiger auf Task struct: <a class="el" href="struct_cos_task__t.html">CosTask_t</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">nichts</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Code Beispiel:</dt><dd><pre class="fragment">CosSema_t sema_1;
...
void myTask(CosTask_t *pt)
{
    COS_TASK_BEGIN(pt);

    serPuts("myTask: started...\n");
    serPuts("myTask: step0\n");

    COS_SEM_WAIT(&amp;sema_1,pt);

    serPuts("myTask: step1\n");
    COS_TASK_SCHEDULE(pt);
    serPuts("mserPutsyTask: step2\n");
    COS_TASK_SCHEDULE(pt);
    serPuts("myTask: step3\n");
    COS_TASK_SCHEDULE(pt);
    serPuts("myTask: step4\n");
    COS_TASK_SCHEDULE(pt);
    serPuts("myTask: terminates...\n");

    COS_TASK_END(pt);
}
</pre> </dd></dl>

<p>Definition at line <a class="el" href="cos__semaphore_8h_source.html#l00155">155</a> of file <a class="el" href="cos__semaphore_8h_source.html">cos_semaphore.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a47f0dd5e1224cd8355208dd3b53d6e86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void COS_SEM_SIGNAL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_cos_sema__t.html">CosSema_t</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section user"><dt>Beschreibung</dt><dd>Inkrementiert den Zaehler des Semaphor. Die Liste der wartenden Tasks wird untersucht und die erste Task in der Liste wird in den Zustand TASK_STATE_READY gesetzt und aus der Liste der wartenden Tasks geloescht.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><ul>
<li></li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>- IN/OUT, Zeiger auf Semaphore</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Code-Beispiel::</dt><dd><pre class="fragment">CosSema_t sema_1;
...
void myTask2(CosTask_t *pt)
{   static count =0;
    COS_TASK_BEGIN(pt);

    serPuts("myTask2: started...\n");
    while(count &lt; 100)
    {    serPuts("Task2\n");
         count++;
         COS_TASK_SLEEP(pt,100);
    }

    COS_SEM_SIGNAL(&amp;sema_1);

    serPuts("myTask: terminates...\n");

    COS_TASK_END(pt);
}
</pre> </dd></dl>
<p>&lt; pointer to task structure </p>

<p>Definition at line <a class="el" href="cos__semaphore_8c_source.html#l00231">231</a> of file <a class="el" href="cos__semaphore_8c_source.html">cos_semaphore.c</a>.</p>

</div>
</div>
<a class="anchor" id="a08f75de99241fa21e57101d977049c2a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cos__types_8h.html#ab077fa1127453be2bd9d4c3c8a768fa7">uint8_t</a> COS_SemCreate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_cos_sema__t.html">CosSema_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cos__types_8h.html#a9702e5ca80edeea90fa9b8fae49f05ce">int8_t</a>&#160;</td>
          <td class="paramname"><em>n_start</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section user"><dt>Beschreibung</dt><dd>Initialisiet den Semaphor mit dem gegebenen Zaehlerstand, erzeugt eine noch leere Liste von Tasks, die an diesem Semaphor warten.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><ul>
<li></li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>- IN/OUT, Zeiger auf Semaphore </td></tr>
    <tr><td class="paramname">n_start</td><td>- IN, Zaehlerstand des Semaphore nach Initialisierung</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>fuer ok, negativ bei Fehler.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Code-Beispiel:</dt><dd><pre class="fragment">CosSema_t sema_1;
...
int main(void)
{   ...
    serPuts("hello");

    if(0!=COS_InitTaskList())
    {   serPuts("COS_InitScheduler has crashed...");
    }
    COS_PrintTaskList();

    COS_SemCreate(&amp;sema_1, 0);


    tA = COS_CreateTask(1, NULL, myTask);
    tB = COS_CreateTask(2, NULL, myTask2);
    tC = COS_CreateTask(3, NULL, myTask3);

    if(0!=COS_RunScheduler())
    {   serPuts("COS_RunScheduler has crashed...");
    }

    getchar();
    return 0;
}
</pre> </dd></dl>

<p>Definition at line <a class="el" href="cos__semaphore_8c_source.html#l00130">130</a> of file <a class="el" href="cos__semaphore_8c_source.html">cos_semaphore.c</a>.</p>

</div>
</div>
<a class="anchor" id="acc1c9e15246c77eb7e5325049600de5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cos__types_8h.html#ab077fa1127453be2bd9d4c3c8a768fa7">uint8_t</a> COS_SemDestroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_cos_sema__t.html">CosSema_t</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section user"><dt>Beschreibung</dt><dd>Loescht die Task-Liste dieses Semaphor. Die Tasks werden natuerlich nicht gelosecht!</dd></dl>
<dl class="section see"><dt>See also</dt><dd><ul>
<li></li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>- IN/OUT, Zeiger auf Semaphore</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>fuer ok, negativ bei Fehler</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Code-Beispiel:</dt><dd><pre class="fragment">CosSema_t sema_1;
...
int main(void)
{   ...
    serPuts("hello");

    if(0!=COS_InitTaskList())
    {   serPuts("COS_InitScheduler has crashed...");
    }
    COS_SemCreate(&amp;sema_1, 0);
    ...
    COS_SemDestroy(&amp;sema_1);

    getchar();
    return 0;
}</pre> </dd></dl>

<p>Definition at line <a class="el" href="cos__semaphore_8c_source.html#l00178">178</a> of file <a class="el" href="cos__semaphore_8c_source.html">cos_semaphore.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
